<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .btn {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Integration Test</h1>
        
        <div class="test-card">
            <h2>API Connection Tests</h2>
            <button class="btn" onclick="testAccountsAPI()">Test Accounts API</button>
            <button class="btn" onclick="testPartiesAPI()">Test Parties API</button>
            <button class="btn" onclick="testItemsAPI()">Test Items API</button>
            <button class="btn" onclick="testTransactionsAPI()">Test Transactions API</button>
            <button class="btn" onclick="testReportsAPI()">Test Reports API</button>
            
            <div id="api-results"></div>
        </div>
        
        <div class="test-card">
            <h2>Dashboard Data Tests</h2>
            <button class="btn" onclick="testDashboardData()">Load Dashboard Data</button>
            <div id="dashboard-results"></div>
        </div>
        
        <div class="test-card">
            <h2>Navigation Tests</h2>
            <button class="btn" onclick="testNavigation()">Test Navigation</button>
            <div id="navigation-results"></div>
        </div>
    </div>

    <script>
        const API_BASE = './api';
        
        async function testAPI(url, testName) {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML += `<div class="test-result">Testing ${testName}...</div>`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                resultsDiv.innerHTML += `
                    <div class="test-result success">
                        <strong>${testName}:</strong> Success<br>
                        Response: ${JSON.stringify(data).substring(0, 100)}...
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="test-result error">
                        <strong>${testName}:</strong> Failed<br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
        
        function testAccountsAPI() {
            testAPI(`${API_BASE}/accounts.php`, 'Accounts API');
        }
        
        function testPartiesAPI() {
            testAPI(`${API_BASE}/parties.php`, 'Parties API');
        }
        
        function testItemsAPI() {
            testAPI(`${API_BASE}/items.php`, 'Items API');
        }
        
        function testTransactionsAPI() {
            testAPI(`${API_BASE}/transactions.php`, 'Transactions API');
        }
        
        function testReportsAPI() {
            testAPI(`${API_BASE}/reports.php?type=sales`, 'Reports API');
        }
        
        async function testDashboardData() {
            const resultsDiv = document.getElementById('dashboard-results');
            resultsDiv.innerHTML = '<div class="test-result">Loading dashboard data...</div>';
            
            try {
                // Test sales data
                const salesResponse = await fetch(`${API_BASE}/reports.php?type=sales`);
                if (!salesResponse.ok) throw new Error('Failed to load sales data');
                const salesData = await salesResponse.json();
                
                // Test purchases data
                const purchasesResponse = await fetch(`${API_BASE}/reports.php?type=purchase`);
                if (!purchasesResponse.ok) throw new Error('Failed to load purchases data');
                const purchasesData = await purchasesResponse.json();
                
                // Test stock data
                const stockResponse = await fetch(`${API_BASE}/reports.php?type=stock`);
                if (!stockResponse.ok) throw new Error('Failed to load stock data');
                const stockData = await stockResponse.json();
                
                resultsDiv.innerHTML = `
                    <div class="test-result success">
                        <strong>Dashboard Data Load:</strong> Success<br>
                        Sales data: ${Array.isArray(salesData) ? salesData.length : 'N/A'} records<br>
                        Purchases data: ${Array.isArray(purchasesData) ? purchasesData.length : 'N/A'} records<br>
                        Stock data: ${Array.isArray(stockData) ? stockData.length : 'N/A'} records
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>Dashboard Data Load:</strong> Failed<br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
        
        function testNavigation() {
            const resultsDiv = document.getElementById('navigation-results');
            resultsDiv.innerHTML = '<div class="test-result">Testing navigation...</div>';
            
            try {
                // Test if required DOM elements exist
                const appElement = document.getElementById('app');
                const dashboardView = document.getElementById('dashboard-view');
                const accountsView = document.getElementById('accounts-view');
                const inventoryView = document.getElementById('inventory-view');
                const transactionsView = document.getElementById('transactions-view');
                const reportsView = document.getElementById('reports-view');
                
                const navLinks = document.querySelectorAll('.nav-link');
                const tabButtons = document.querySelectorAll('.tab-button');
                
                if (!appElement) throw new Error('App element not found');
                if (!dashboardView) throw new Error('Dashboard view not found');
                if (!accountsView) throw new Error('Accounts view not found');
                if (!inventoryView) throw new Error('Inventory view not found');
                if (!transactionsView) throw new Error('Transactions view not found');
                if (!reportsView) throw new Error('Reports view not found');
                if (navLinks.length === 0) throw new Error('Navigation links not found');
                if (tabButtons.length === 0) throw new Error('Tab buttons not found');
                
                resultsDiv.innerHTML = `
                    <div class="test-result success">
                        <strong>Navigation Test:</strong> Success<br>
                        Found all required elements:<br>
                        - App element: ✓<br>
                        - Dashboard view: ✓<br>
                        - Accounts view: ✓<br>
                        - Inventory view: ✓<br>
                        - Transactions view: ✓<br>
                        - Reports view: ✓<br>
                        - Navigation links: ${navLinks.length} found<br>
                        - Tab buttons: ${tabButtons.length} found
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        <strong>Navigation Test:</strong> Failed<br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>